# Расчет минимального спреда для Funding Arbitrage

## Комиссии бирж

### OKX Perpetual
Источник: https://www.okx.com/fees/

- **Maker fee**: 0.02% (0.0002)
- **Taker fee**: 0.05% (0.0005)
- **Funding interval**: Каждые 8 часов (00:00, 08:00, 16:00 UTC)
- **Quote currency**: USDT

### Hyperliquid Perpetual
Источник: https://hyperliquid.gitbook.io/hyperliquid-docs/trading/fees

- **Maker fee**: 0% (maker rebate -0.02%, т.е. вы получаете деньги за maker ордера!)
- **Taker fee**: 0.025% (0.00025)
- **Funding interval**: Каждый час
- **Quote currency**: USD

## Расчет минимального спреда

### Сценарий 1: Использование Market Orders (Taker)

При открытии позиций по рынку (market orders):

**Комиссии на вход:**
- OKX taker fee: 0.05%
- Hyperliquid taker fee: 0.025%
- **Итого на вход**: 0.075%

**Комиссии на выход:**
- OKX taker fee: 0.05%
- Hyperliquid taker fee: 0.025%
- **Итого на выход**: 0.075%

**Общие комиссии за полный цикл**: 0.075% + 0.075% = **0.15%**

### Сценарий 2: Использование Limit Orders (Maker)

При открытии позиций лимитными ордерами (получаем maker rebate):

**Комиссии на вход:**
- OKX maker fee: 0.02%
- Hyperliquid maker rebate: -0.02% (получаем!)
- **Итого на вход**: 0% (нейтрально)

**Комиссии на выход:**
- OKX maker fee: 0.02%
- Hyperliquid maker rebate: -0.02%
- **Итого на выход**: 0% (нейтрально)

**Общие комиссии за полный цикл**: **~0%** (почти бесплатно!)

### Рекомендуемые минимальные спреды

#### Для Market Orders (быстрый вход):

**Минимальный profitable спред:**
- Комиссии: 0.15%
- Slippage (оценка): 0.05%
- Буфер безопасности: 0.1%
- **ИТОГО**: **0.3% или выше**

**В годовом выражении** (если держать 1 день):
- 0.3% в день = 109.5% APR
- Это очень высокая доходность, но funding rates редко бывают настолько высокими

**Практический минимум**:
- Для краткосрочной торговли (1-3 дня): **0.2-0.3%**
- Для среднесрочной (1-2 недели): **0.15-0.2%**
- Для долгосрочной (месяц+): **0.1-0.15%**

#### Для Limit Orders (терпеливый вход):

**Минимальный profitable спред:**
- Комиссии: ~0%
- Slippage: минимальный
- Буфер безопасности: 0.05%
- **ИТОГО**: **0.05-0.1% или выше**

Это НАМНОГО лучше! При использовании maker orders вы можете получать прибыль даже от небольших спредов.

## Нормализация funding rates

### Важно понимать!

OKX и Hyperliquid показывают funding rates в разных форматах:

- **OKX**: Ставка за 8 часов
- **Hyperliquid**: Ставка за 1 час

Для сравнения нужно **нормализовать** к одному периоду.

### Пример расчета:

**Допустим:**
- OKX funding rate: 0.01% (каждые 8 часов)
- Hyperliquid funding rate: 0.05% (каждый час)

**Нормализация к 24 часам:**
- OKX: 0.01% × 3 = 0.03% в день (3 раза по 8 часов)
- Hyperliquid: 0.05% × 24 = 1.2% в день (24 раза по часу)

**Разница (спред):** 1.2% - 0.03% = **1.17% в день**

Это отличный спред для арбитража!

## Оптимальная конфигурация

### Рекомендуемые настройки в conf/funding_rate_arb.yml:

```yaml
# Для AGРЕССИВНОЙ стратегии (market orders, быстрый вход)
min_funding_rate_profitability: 0.003  # 0.3% в день минимум

# Для КОНСЕРВАТИВНОЙ стратегии (limit orders, терпеливый вход)
min_funding_rate_profitability: 0.001  # 0.1% в день минимум

# Для СБАЛАНСИРОВАННОЙ стратегии
min_funding_rate_profitability: 0.0015  # 0.15% в день минимум
```

### С учетом нормализации на 24 часа:

Бот автоматически нормализует ставки. В конфигурации `min_funding_rate_profitability` указывается **дневная прибыльность**.

## Формула расчета прибыли

### Чистая прибыль за период:

```
Net Profit = (Funding Spread × Position Size × Days) - Total Fees - Slippage
```

Где:
- **Funding Spread** = |OKX_rate_daily - Hyperliquid_rate_daily|
- **Position Size** = размер позиции в USD
- **Days** = количество дней удержания
- **Total Fees** = комиссии на вход и выход
- **Slippage** = проскальзывание (обычно 0.05-0.1%)

### Пример:

**Параметры:**
- Funding spread: 0.5% в день
- Position size: $1000
- Holding period: 7 дней
- Leverage: 3x
- Fees (market orders): 0.15%
- Slippage: 0.05%

**Расчет:**

1. **Gross funding profit:**
   - 0.5% × $1000 × 7 дней = $35

2. **Fees on entry:**
   - 0.15% × $1000 = $1.50

3. **Fees on exit:**
   - 0.15% × $1000 = $1.50

4. **Slippage:**
   - 0.05% × $1000 × 2 (вход и выход) = $1.00

5. **Total costs:**
   - $1.50 + $1.50 + $1.00 = $4.00

6. **Net profit:**
   - $35 - $4 = **$31**

7. **ROI:**
   - $31 / $1000 = 3.1% за неделю
   - **Годовая доходность (APR)**: 3.1% × 52 = **161% APR**

## Риски и ограничения

### 1. Ликвидация (Liquidation)

При использовании leverage есть риск ликвидации если цена сильно движется:

- **Leverage 1x**: практически нет риска (требуется 100% движение цены)
- **Leverage 3x**: риск при ~33% движении
- **Leverage 5x**: риск при ~20% движении
- **Leverage 10x**: риск при ~10% движении

**Рекомендация**: Используйте leverage 1-3x для минимизации риска.

### 2. Funding Rate Reversal

Funding rates могут развернуться:
- Положительный спред может стать отрицательным
- Это уменьшит прибыль или даже создаст убыток

**Рекомендация**: Закрывайте позиции когда спред уменьшается ниже минимума.

### 3. Exchange Downtime

Если одна биржа недоступна:
- Не можете закрыть позицию на одной стороне
- Подвержены рыночному риску

**Рекомендация**: Используйте stop-loss и мониторьте 24/7.

### 4. Недостаточная ликвидность

На малоликвидных парах:
- Большой slippage
- Не можете быстро закрыть позицию

**Рекомендация**: Торгуйте только топовыми токенами (BTC, ETH, SOL и т.д.)

## Рекомендации по токенам

### Топ-приоритет (высокая ликвидность):
- BTC, ETH, SOL, BNB, XRP, ADA, DOT, AVAX, MATIC, LINK

### Средний приоритет (хорошая ликвидность):
- ARB, OP, ATOM, NEAR, APT, SUI, FTM, ALGO, UNI, AAVE

### Низкий приоритет (осторожно - низкая ликвидность):
- Все остальные альткоины

**ВАЖНО**: Всегда проверяйте ликвидность на обеих биржах перед торговлей!

## Практические советы

1. **Начните с малого**: Тестируйте с $100-500
2. **Используйте низкий leverage**: 1-3x для начала
3. **Мониторьте ежедневно**: Проверяйте спреды и позиции
4. **Диверсифицируйте**: Не ставьте все на один токен
5. **Используйте limit orders**: Экономьте на комиссиях
6. **Закрывайтесь при развороте**: Не держите убыточные позиции
7. **Учитывайте налоги**: В некоторых юрисдикциях funding payments облагаются налогом

## Итоговые рекомендации

### Оптимальная конфигурация для начинающих:

```yaml
min_funding_rate_profitability: 0.002  # 0.2% в день - безопасный минимум
position_size_quote: 100               # $100 на позицию
leverage: 3                            # 3x leverage - баланс риска и прибыли
connectors:
  - okx_perpetual
  - hyperliquid_perpetual
tokens:
  # Только топовые токены с высокой ликвидностью
  - BTC
  - ETH
  - SOL
  - BNB
  - XRP
  - ADA
  - DOT
  - AVAX
  - MATIC
  - LINK
```

### Продвинутая конфигурация (для опытных):

```yaml
min_funding_rate_profitability: 0.001  # 0.1% в день - используем maker orders
position_size_quote: 500               # $500 на позицию
leverage: 5                            # 5x leverage
connectors:
  - okx_perpetual
  - hyperliquid_perpetual
tokens:
  # Все доступные токены с адекватной ликвидностью
  - BTC
  - ETH
  - SOL
  - BNB
  - XRP
  - ADA
  - DOT
  - AVAX
  - MATIC
  - LINK
  - ARB
  - OP
  - ATOM
  - NEAR
  - APT
  - SUI
  - FTM
  - ALGO
  - UNI
  - AAVE
  # ... добавьте еще по желанию
```

## Заключение

**Минимальный profitable спред зависит от:**
1. Типа ордеров (market vs limit)
2. Размера позиции
3. Периода удержания
4. Ликвидности токена
5. Вашей толерантности к риску

**Безопасные минимумы:**
- **Conservative (limit orders)**: 0.001 (0.1% в день)
- **Balanced (mix)**: 0.0015 (0.15% в день)
- **Aggressive (market orders)**: 0.002-0.003 (0.2-0.3% в день)

Начните консервативно и постепенно оптимизируйте на основе ваших результатов!
